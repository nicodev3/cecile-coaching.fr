---
const reveal =
	'opacity-0 translate-y-4 transition duration-700 ease-out will-change-transform will-change-opacity motion-reduce:transition-none data-[revealed=true]:opacity-100 data-[revealed=true]:translate-y-0';
---

<section
	id="contact"
	class={`py-14 sm:py-18 ${reveal}`}
	data-reveal
	data-revealed="false"
	aria-labelledby="contact-title"
>
	<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
		<div class="mx-auto max-w-3xl">
			<div class="text-center">
				<h2 id="contact-title" class="text-2xl font-semibold text-slate-900 sm:text-3xl">
					Me contacter
				</h2>
				<p class="mt-4 text-base leading-relaxed text-slate-800">
					Remplis le formulaire ci-dessous et je te répondrai dans les meilleurs délais.
				</p>
			</div>

			<!-- Numéro de téléphone protégé contre les robots -->
			<div class="mt-6 flex items-center justify-center gap-2 rounded-xl bg-slate-50 p-3 ring-1 ring-slate-200">
				<svg class="h-5 w-5 shrink-0 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
				</svg>
				<span class="text-sm text-slate-700">Téléphone :</span>
				<a
					id="phone-link"
					href="#"
					class="text-sm font-semibold text-[color:var(--plum)] hover:underline"
					aria-label="Téléphone"
				>
					<span id="phone-display">Chargement...</span>
				</a>
			</div>

			<div class="mt-8 rounded-[2rem] bg-white/60 p-6 ring-1 ring-black/5 shadow-sm shadow-black/5 sm:p-8">
				<form
					name="contact"
					method="POST"
					data-netlify="true"
					data-netlify-honeypot="bot-field"
					action="/"
					class="space-y-4"
				>
					<input type="hidden" name="form-name" value="contact" />
					<input type="hidden" name="bot-field" />

					<div>
						<label for="name" class="block text-sm font-medium text-slate-900">
							Nom <span class="text-slate-500">*</span>
						</label>
						<input
							type="text"
							id="name"
							name="name"
							required
							class="mt-1.5 w-full rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm text-slate-900 placeholder-slate-400 transition focus:border-[color:var(--plum)] focus:outline-none focus:ring-2 focus:ring-[color:var(--plum)]/20"
							placeholder="Ton nom"
						/>
					</div>

					<div>
						<label for="email" class="block text-sm font-medium text-slate-900">
							Email <span class="text-slate-500">*</span>
						</label>
						<input
							type="email"
							id="email"
							name="email"
							required
							class="mt-1.5 w-full rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm text-slate-900 placeholder-slate-400 transition focus:border-[color:var(--plum)] focus:outline-none focus:ring-2 focus:ring-[color:var(--plum)]/20"
							placeholder="ton@email.com"
						/>
					</div>

					<div>
						<label for="phone" class="block text-sm font-medium text-slate-900">
							Téléphone
						</label>
						<input
							type="tel"
							id="phone"
							name="phone"
							class="mt-1.5 w-full rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm text-slate-900 placeholder-slate-400 transition focus:border-[color:var(--plum)] focus:outline-none focus:ring-2 focus:ring-[color:var(--plum)]/20"
							placeholder="06 12 34 56 78 (optionnel)"
						/>
					</div>

					<div>
						<label for="message" class="block text-sm font-medium text-slate-900">
							Message <span class="text-slate-500">*</span>
						</label>
						<textarea
							id="message"
							name="message"
							required
							rows="5"
							class="mt-1.5 w-full rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm text-slate-900 placeholder-slate-400 transition focus:border-[color:var(--plum)] focus:outline-none focus:ring-2 focus:ring-[color:var(--plum)]/20"
							placeholder="Ton message..."
						></textarea>
					</div>

					<div id="form-success" class="hidden rounded-xl bg-green-50 p-4 text-sm text-green-800 ring-1 ring-green-200">
						<p class="font-medium">Message envoyé avec succès !</p>
						<p class="mt-1">Je te répondrai dans les meilleurs délais.</p>
					</div>

					<div id="form-error" class="hidden rounded-xl bg-red-50 p-4 text-sm text-red-800 ring-1 ring-red-200">
						<p class="font-medium">Une erreur est survenue.</p>
						<p class="mt-1">Veuillez réessayer ou m'envoyer un email directement à cecile.c.coach@gmail.com</p>
					</div>

					<button
						type="submit"
						class="w-full rounded-2xl bg-[color:var(--plum)] px-6 py-3 text-sm font-semibold text-white shadow-sm shadow-black/10 transition hover:brightness-105 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-4 focus-visible:outline-[color:var(--plum)]"
					>
						Envoyer le message
					</button>
				</form>
			</div>
		</div>
	</div>
</section>

<script is:inline>
	// Protection du numéro de téléphone contre les robots
	(function() {
		// Numéro fragmenté pour éviter le scraping automatique
		// Les robots simples ne peuvent pas facilement extraire le numéro complet
		const a = '0' + '6';
		const b = '8' + '6';
		const c = '4' + '1';
		const d = '5' + '7';
		const e = '0' + '1';
		const phoneNumber = a + b + c + d + e;
		const phoneDisplay = phoneNumber.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/, '$1 $2 $3 $4 $5');
		
		const phoneLink = document.getElementById('phone-link');
		const phoneDisplayEl = document.getElementById('phone-display');
		
		if (phoneLink && phoneDisplayEl) {
			phoneLink.href = 'tel:+33' + phoneNumber.substring(1);
			phoneDisplayEl.textContent = phoneDisplay;
		}
	})();
</script>

<script>
	const form = document.querySelector('form[name="contact"]') as HTMLFormElement | null;
	const formSuccess = document.getElementById('form-success');
	const formError = document.getElementById('form-error');

	// Gestion de la soumission du formulaire
	if (form) {
		form.addEventListener('submit', async (e) => {
			e.preventDefault();

			const formData = new FormData(form);
			const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement | null;
			const originalText = submitButton?.textContent;

			// Masquer les messages précédents
			formSuccess?.classList.add('hidden');
			formError?.classList.add('hidden');

			// Désactiver le bouton
			if (submitButton) {
				submitButton.disabled = true;
				submitButton.textContent = 'Envoi en cours...';
			}

			try {
				const response = await fetch('/', {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: new URLSearchParams(formData as any).toString(),
				});

				if (response.ok) {
					formSuccess?.classList.remove('hidden');
					form.reset();
					// Scroll vers le message de succès
					formSuccess?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
				} else {
					throw new Error('Erreur lors de l\'envoi');
				}
			} catch (error) {
				formError?.classList.remove('hidden');
				formError?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
			} finally {
				// Réactiver le bouton
				if (submitButton) {
					submitButton.disabled = false;
					if (originalText) {
						submitButton.textContent = originalText;
					}
				}
			}
		});
	}
</script>
